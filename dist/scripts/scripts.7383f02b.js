"use strict";angular.module("zyringApp",["ngAnimate","ngResource","ngRoute","ngTouch","chart.js","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("zyringApp").controller("MainCtrl",["$scope","RawData",function(a,b){function c(){d(),e()}function d(){var b=_.countBy(a.currentData,function(a){return a.country});a.cityLabels=_.keys(b),a.cityData=_.values(b)}function e(){a.weeklySeries=["Visits"];var b=new Date(a.startDate).getTime()/1e3,c=new Date(a.endDate).getTime()/1e3,d=Math.ceil((c-b)/f);a.weeklyLabels=[];for(var e=1;d>=e;e++)a.weeklyLabels.push("Week "+e);for(var g=[],h=0;d>h;h++)g.push(0);_.each(a.currentData,function(a){var d=a.timestamp;if(d>=b&&c>=d){var e=Math.floor((d-b)/f);g[e]+=1}}),a.weeklyCounts=[g]}a.endDate=(new Date).toDateString(),a.startDate=(new Date).toDateString();var f=604800;b.query().$promise.then(function(b){a.allData=b,a.currentData=a.allData,c()}),a.dateOptions={formatYear:"yy",startingDay:1},a.openStart=function(b){b.preventDefault(),b.stopPropagation(),a.openedStart=!0},a.openEnd=function(b){b.preventDefault(),b.stopPropagation(),a.openedEnd=!0},a.$watch("endDate",function(b){if(a.allData){var d=new Date(b).getTime()/1e3;a.currentData=_.filter(a.allData,function(a){return a.timestamp<=d}),c()}}),a.$watch("startDate",function(b){if(a.allData){var d=new Date(b).getTime()/1e3;a.currentData=_.filter(a.allData,function(a){return a.timestamp>=d}),c()}})}]),angular.module("zyringApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zyringApp").factory("RawData",["$resource",function(a){return a("http://micky.zyring.com/fullEvents")}]);